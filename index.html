<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GIF English - Immersive App</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: #D32F2F;
      color: white;
      text-align: center;
      padding: 1rem;
    }
    nav {
      display: flex;
      justify-content: space-around;
      background: #fff;
      border-bottom: 1px solid #ccc;
    }
    nav button {
      flex: 1;
      padding: 1rem;
      border: none;
      background: white;
      cursor: pointer;
      font-weight: bold;
    }
    nav button.active {
      border-bottom: 3px solid #D32F2F;
      color: #D32F2F;
    }
    section {
      display: none;
      padding: 1rem;
    }
    section.active {
      display: block;
    }
    .card, .lesson-box, .game-box, .chat-box, .quiz-box {
      background: white;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 600px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button {
      margin: 0.3rem;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 5px;
      background: #D32F2F;
      color: white;
      cursor: pointer;
    }
    input, textarea {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      margin: 0.5rem 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .chat-bubble {
      background: #fff;
      padding: 0.5rem 1rem;
      margin: 0.5rem 0;
      border-radius: 10px;
      border-left: 4px solid #D32F2F;
    }
    .chat-bubble small {
      display: block;
      color: #666;
      margin-top: 0.2rem;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }
    .tile {
      padding: 1rem;
      background: #f0f0f0;
      cursor: pointer;
      border-radius: 5px;
      width: 120px;
      text-align: center;
    }
    .score {
      font-weight: bold;
      margin-top: 1rem;
      text-align: center;
    }
    .quiz-question {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

<header>
  <h1>GIF English</h1>
  <p>Learn English the fun way üá¨üáπ ‚ûù üá∫üá∏</p>
</header>

<nav>
  <button class="tab-btn active" onclick="showTab('lesson')">Lesson 1</button>
  <button class="tab-btn" onclick="showTab('flashcards')">Flashcards</button>
  <button class="tab-btn" onclick="showTab('chat')">Roleplay</button>
  <button class="tab-btn" onclick="showTab('game')">Match Game</button>
  <button class="tab-btn" onclick="showTab('quiz')">Quiz</button>
  <button class="tab-btn" onclick="showTab('notes')">Notes</button>
</nav>

<section id="lesson" class="active">
  <div class="lesson-box">
    <h2>Lesson 1: Greetings</h2>
    <p>In English, greetings are the foundation of everyday interaction. They help us open conversations and show kindness to others. Mastering greetings is the first step to feeling confident speaking English!</p>
    <h3>Tips:</h3>
    <ul>
      <li>Use <b>Hello</b> or <b>Hi</b> anytime.</li>
      <li><b>Good morning</b> is used before 12:00 PM.</li>
      <li><b>Good night</b> is for saying goodbye in the evening.</li>
      <li>Always smile and make eye contact üòä</li>
    </ul>
    <h3>Vocabulary:</h3>
    <ul>
      <li><b>Hello</b> ‚Äì Hola</li>
      <li><b>Good morning</b> ‚Äì Buenos d√≠as</li>
      <li><b>Good night</b> ‚Äì Buenas noches</li>
      <li><b>How are you?</b> ‚Äì ¬øC√≥mo est√°s?</li>
    </ul>
  </div>
</section>

<section id="flashcards">
  <div class="card">
    <h2 id="front">Hola</h2>
    <p id="back" style="display:none;"><i>Hello</i></p>
    <button onclick="speak(back.innerText)">üîä Hear</button>
    <button onclick="toggleCard()">Show Answer</button>
    <button onclick="nextCard()">Next</button>
  </div>
</section>

<section id="chat">
  <div class="chat-box">
    <h2>üó£Ô∏è Conversation Practice</h2>
    <div id="dialogue">
      <p id="q0"><b>EnglishBot:</b> Hi! What‚Äôs your name?</p>
    </div>
    <input id="chatInput" placeholder="Type your answer..." />
    <button onclick="nextDialogue()">Send</button>
  </div>
</section>

<section id="game">
  <div class="game-box">
    <h2>üéÆ Match the Words</h2>
    <div class="grid" id="gameGrid"></div>
    <p class="score" id="matchScore">Score: 0 / 4</p>
    <p id="matchMessage"></p>
    <button onclick="resetGame()">Reset Game</button>
  </div>
</section>

<section id="quiz">
  <div class="quiz-box">
    <h2>üìã Quiz: Greetings</h2>
    <div class="quiz-question">
      <p>1. How do you say ‚ÄúGood morning‚Äù in Spanish?</p>
      <input type="text" id="q1" placeholder="Your answer..." />
    </div>
    <div class="quiz-question">
      <p>2. What‚Äôs a polite way to greet someone at night?</p>
      <input type="text" id="q2" placeholder="Your answer..." />
    </div>
    <div class="quiz-question">
      <p>3. How do you ask ‚ÄúHow are you?‚Äù in English?</p>
      <input type="text" id="q3" placeholder="Your answer..." />
    </div>
    <button onclick="submitQuiz()">Submit Quiz</button>
    <div id="quizResult"></div>
  </div>
</section>

<section id="notes">
  <div class="lesson-box">
    <h2>Shared Notes</h2>
    <textarea id="sharedNotes" placeholder="Write something..."></textarea>
    <button onclick="saveNote()">Submit</button>
    <div id="notesDisplay"></div>
  </div>
</section>
<script>
  // ---------------------
  // Tab Navigation
  // ---------------------
  function showTab(tabId) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    event.target.classList.add("active");
  }

  // ---------------------
  // Flashcards
  // ---------------------
  const cards = [
    { es: "Hola", en: "Hello" },
    { es: "Buenos d√≠as", en: "Good morning" },
    { es: "Buenas noches", en: "Good night" },
    { es: "¬øC√≥mo est√°s?", en: "How are you?" },
    { es: "Gracias", en: "Thank you" }
  ];
  let current = 0;
  const front = document.getElementById('front');
  const back = document.getElementById('back');

  function updateCard() {
    front.innerText = cards[current].es;
    back.innerText = cards[current].en;
    back.style.display = 'none';
  }

  function nextCard() {
    current = (current + 1) % cards.length;
    updateCard();
  }

  function toggleCard() {
    back.style.display = back.style.display === 'none' ? 'block' : 'none';
  }

  function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    speechSynthesis.speak(utterance);
  }

  updateCard();

  // ---------------------
  // Roleplay Chat Logic
  // ---------------------
  const dialogue = document.getElementById('dialogue');
  const chatInput = document.getElementById('chatInput');
  const script = [
    { q: "Hi! What‚Äôs your name?", next: "Nice to meet you, {input}! How are you today?" },
    { q: "How are you today?", next: "Great! How old are you?" },
    { q: "How old are you?", next: "Cool! What‚Äôs your favorite hobby?" },
    { q: "What‚Äôs your favorite hobby?", next: "Nice! You're doing awesome!" }
  ];
  let chatStep = 0;

  function nextDialogue() {
    const userText = chatInput.value.trim();
    if (!userText) return;

    const response = document.createElement("p");
    response.innerHTML = `<b>You:</b> ${userText}`;
    dialogue.appendChild(response);

    const botReply = document.createElement("p");
    let replyText = script[chatStep].next.replace("{input}", userText);
    botReply.innerHTML = `<b>EnglishBot:</b> ${replyText}`;
    dialogue.appendChild(botReply);

    chatStep++;
    chatInput.value = "";

    if (chatStep < script.length && !document.getElementById('q' + chatStep)) {
      const nextQ = document.createElement("p");
      nextQ.id = 'q' + chatStep;
      nextQ.innerHTML = `<b>EnglishBot:</b> ${script[chatStep].q}`;
      dialogue.appendChild(nextQ);
    }
  }

  // ---------------------
  // Match Game
  // ---------------------
  const gameWords = [
    { en: "Hello", es: "Hola" },
    { en: "Thank you", es: "Gracias" },
    { en: "Please", es: "Por favor" },
    { en: "Goodbye", es: "Adi√≥s" }
  ];
  let selections = [];
  let matchedPairs = [];
  const totalPairs = gameWords.length;

  function renderGame() {
    const shuffled = [...gameWords.flatMap(w => [w.en, w.es])].sort(() => Math.random() - 0.5);
    const grid = document.getElementById('gameGrid');
    grid.innerHTML = '';
    shuffled.forEach(word => {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.textContent = word;
      tile.onclick = () => selectTile(tile);
      grid.appendChild(tile);
    });
    updateMatchScore();
  }

  function updateMatchScore() {
    document.getElementById('matchScore').innerText = `Score: ${matchedPairs.length} / ${totalPairs}`;
  }

  function selectTile(tile) {
    if (tile.classList.contains('matched') || selections.includes(tile.innerText)) return;

    tile.style.background = '#ffdede';
    selections.push(tile.innerText);
    if (selections.length === 2) {
      const match = gameWords.find(w =>
        (w.en === selections[0] && w.es === selections[1]) ||
        (w.en === selections[1] && w.es === selections[0])
      );

      if (match) {
        document.getElementById('matchMessage').innerText = '‚úÖ Correct match!';
        matchedPairs.push(match.en);
        setTimeout(() => {
          const tiles = [...document.querySelectorAll('.tile')];
          tiles.forEach(t => {
            if (t.innerText === match.en || t.innerText === match.es) {
              t.classList.add('matched');
              t.style.background = '#d3ffd3';
            }
          });
          selections = [];
          updateMatchScore();
          if (matchedPairs.length === totalPairs) {
            document.getElementById('matchMessage').innerText = 'üéâ All matched!';
          }
        }, 500);
      } else {
        document.getElementById('matchMessage').innerText = '‚ùå Try again!';
        setTimeout(() => {
          selections = [];
          document.querySelectorAll('.tile').forEach(t => {
            if (!t.classList.contains('matched')) t.style.background = '#f0f0f0';
          });
          document.getElementById('matchMessage').innerText = '';
        }, 1000);
      }
    }
  }

  function resetGame() {
    matchedPairs = [];
    selections = [];
    renderGame();
    document.getElementById('matchMessage').innerText = '';
  }

  renderGame();
</script>
<script>
  // ---------------------
  // Quiz Logic
  // ---------------------
  function generateQuizID(score) {
    const date = new Date().toISOString();
    const base = score + date + Math.random().toString();
    return btoa(base).slice(0, 10); // Short hash
  }

  function submitQuiz() {
    const a1 = document.getElementById('q1').value.trim().toLowerCase();
    const a2 = document.getElementById('q2').value.trim().toLowerCase();
    const a3 = document.getElementById('q3').value.trim().toLowerCase();

    let score = 0;
    if (a1.includes("buenos d√≠as")) score++;
    if (a2.includes("good night")) score++;
    if (a3.includes("how are you")) score++;

    const quizID = generateQuizID(score);
    const result = `
      <h3>Your Score: ${score}/3</h3>
      <p>Quiz ID: <code>${quizID}</code></p>
      <p>üì∏ You can screenshot this result as proof!</p>
    `;
    document.getElementById('quizResult').innerHTML = result;
  }

  // ---------------------
  // Notes with Gun.js
  // ---------------------
  const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
  const notes = gun.get('gif-english-notes');
  const textarea = document.getElementById('sharedNotes');
  const notesDisplay = document.getElementById('notesDisplay');

  function saveNote() {
    const text = textarea.value.trim();
    if (!text) return;
    const name = prompt("Enter your name:");
    const timestamp = new Date().toLocaleString();
    const note = { name, text, timestamp };
    notes.set(note);
    textarea.value = '';
  }

  notes.map().on((data, id) => {
    if (!data || !data.text || document.getElementById(id)) return;
    const bubble = document.createElement('div');
    bubble.className = 'chat-bubble';
    bubble.id = id;
    bubble.innerHTML = `${data.text}<small>${data.name} @ ${data.timestamp}</small>`;
    notesDisplay.appendChild(bubble);
  });
</script>
</body>
</html>
