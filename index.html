<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GIF English - Immersive App</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: #D32F2F;
      color: white;
      text-align: center;
      padding: 1rem;
    }
    nav {
      display: flex;
      justify-content: space-around;
      background: #fff;
      border-bottom: 1px solid #ccc;
    }
    nav button {
      flex: 1;
      padding: 1rem;
      border: none;
      background: white;
      cursor: pointer;
      font-weight: bold;
    }
    nav button.active {
      border-bottom: 3px solid #D32F2F;
      color: #D32F2F;
    }
    section {
      display: none;
      padding: 1rem;
    }
    section.active {
      display: block;
    }
    .card, .lesson-box, .game-box, .chat-box {
      background: white;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 600px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button {
      margin: 0.3rem;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 5px;
      background: #D32F2F;
      color: white;
      cursor: pointer;
    }
    input {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      margin: 0.5rem 0;
    }
    .chat-bubble {
      background: #fff;
      padding: 0.5rem 1rem;
      margin: 0.5rem 0;
      border-radius: 10px;
      border-left: 4px solid #D32F2F;
    }
    .chat-bubble small {
      display: block;
      color: #666;
      margin-top: 0.2rem;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }
    .tile {
      padding: 1rem;
      background: #f0f0f0;
      cursor: pointer;
      border-radius: 5px;
      width: 120px;
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 100px;
      padding: 0.5rem;
      margin-top: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<header>
  <h1>GIF English</h1>
  <p>Learn English the fun way üá¨üáπ ‚ûù üá∫üá∏</p>
</header>

<nav>
  <button class="tab-btn active" onclick="showTab('flashcards')">Flashcards</button>
  <button class="tab-btn" onclick="showTab('lesson')">Lesson 1</button>
  <button class="tab-btn" onclick="showTab('chat')">Roleplay</button>
  <button class="tab-btn" onclick="showTab('game')">Match Game</button>
  <button class="tab-btn" onclick="showTab('notes')">Notes</button>
</nav>

<section id="flashcards" class="active">
  <div class="card">
    <h2 id="front">Hola</h2>
    <p id="back" style="display:none;"><i>Hello</i></p>
    <button onclick="speak(back.innerText)">üîä Hear</button>
    <button onclick="toggleCard()">Show Answer</button>
    <button onclick="nextCard()">Next</button>
  </div>
</section>

<section id="lesson">
  <div class="lesson-box">
    <h2>Lesson 1: Greetings</h2>
    <ul>
      <li><b>Hello</b> ‚Äì Hola</li>
      <li><b>Good morning</b> ‚Äì Buenos d√≠as</li>
      <li><b>Good night</b> ‚Äì Buenas noches</li>
      <li><b>How are you?</b> ‚Äì ¬øC√≥mo est√°s?</li>
    </ul>
  </div>
</section>

<section id="chat">
  <div class="chat-box">
    <h2>üó£Ô∏è Conversation Practice</h2>
    <div id="dialogue">
      <p id="q0"><b>EnglishBot:</b> Hi! What‚Äôs your name?</p>
    </div>
    <input id="chatInput" placeholder="Type your answer..." />
    <button onclick="nextDialogue()">Send</button>
  </div>
</section>

<section id="game">
  <div class="game-box">
    <h2>üéÆ Match the Words</h2>
    <div class="grid" id="gameGrid"></div>
    <p id="matchMessage"></p>
  </div>
</section>

<section id="notes">
  <div class="lesson-box">
    <h2>Shared Notes</h2>
    <textarea id="sharedNotes" placeholder="Write something..."></textarea>
    <button onclick="saveNote()">Submit</button>
    <div id="notesDisplay"></div>
  </div>
</section>
<script>
  // ---------------------
  // Tab Navigation
  // ---------------------
  function showTab(tabId) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    event.target.classList.add("active");
  }

  // ---------------------
  // Flashcards
  // ---------------------
  const cards = [
    { es: "Hola", en: "Hello" },
    { es: "Buenos d√≠as", en: "Good morning" },
    { es: "Buenas noches", en: "Good night" },
    { es: "¬øC√≥mo est√°s?", en: "How are you?" },
    { es: "Gracias", en: "Thank you" }
  ];
  let current = 0;
  const front = document.getElementById('front');
  const back = document.getElementById('back');

  function updateCard() {
    front.innerText = cards[current].es;
    back.innerText = cards[current].en;
    back.style.display = 'none';
  }

  function nextCard() {
    current = (current + 1) % cards.length;
    updateCard();
  }

  function toggleCard() {
    back.style.display = back.style.display === 'none' ? 'block' : 'none';
  }

  function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    speechSynthesis.speak(utterance);
  }

  updateCard();

  // ---------------------
  // Roleplay Conversation
  // ---------------------
  const dialogue = document.getElementById('dialogue');
  const chatInput = document.getElementById('chatInput');
  const script = [
    { q: "Hi! What‚Äôs your name?", next: "Nice to meet you, {input}! How are you today?" },
    { q: "How are you today?", next: "Great! How old are you?" },
    { q: "How old are you?", next: "Cool! What‚Äôs your favorite hobby?" },
    { q: "What‚Äôs your favorite hobby?", next: "Nice! You're doing awesome!" }
  ];
  let chatStep = 0;

  function nextDialogue() {
    const userText = chatInput.value.trim();
    if (!userText) return;

    const bot = script[chatStep];
    const response = document.createElement("p");
    response.innerHTML = `<b>You:</b> ${userText}`;
    dialogue.appendChild(response);

    chatStep++;
    setTimeout(() => {
      const botReply = document.createElement("p");
      let replyText = script[chatStep - 1].next.replace("{input}", userText);
      botReply.innerHTML = `<b>EnglishBot:</b> ${replyText}`;
      dialogue.appendChild(botReply);
      chatInput.value = "";

      if (chatStep < script.length && !document.getElementById('q' + chatStep)) {
        const nextQ = document.createElement("p");
        nextQ.id = 'q' + chatStep;
        nextQ.innerHTML = `<b>EnglishBot:</b> ${script[chatStep].q}`;
        dialogue.appendChild(nextQ);
      }
    }, 500);
  }

  // ---------------------
  // Match Game
  // ---------------------
  const gameWords = [
    { en: "Hello", es: "Hola" },
    { en: "Thank you", es: "Gracias" },
    { en: "Please", es: "Por favor" },
    { en: "Goodbye", es: "Adi√≥s" }
  ];
  let selections = [];

  function renderGame() {
    const shuffled = [...gameWords.flatMap(w => [w.en, w.es])].sort(() => Math.random() - 0.5);
    const grid = document.getElementById('gameGrid');
    grid.innerHTML = '';
    shuffled.forEach(word => {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.textContent = word;
      tile.onclick = () => selectTile(tile);
      grid.appendChild(tile);
    });
  }

  function selectTile(tile) {
    tile.style.background = '#ffdede';
    selections.push(tile.innerText);
    if (selections.length === 2) {
      const match = gameWords.find(w =>
        (w.en === selections[0] && w.es === selections[1]) ||
        (w.en === selections[1] && w.es === selections[0])
      );
      document.getElementById('matchMessage').innerText = match ? '‚úÖ Correct match!' : '‚ùå Try again!';
      setTimeout(() => {
        renderGame();
        selections = [];
        document.getElementById('matchMessage').innerText = '';
      }, 1500);
    }
  }

  renderGame();

  // ---------------------
  // Notes with Bubbles
  // ---------------------
  const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
  const notes = gun.get('gif-english-notes');
  const textarea = document.getElementById('sharedNotes');
  const notesDisplay = document.getElementById('notesDisplay');

  function saveNote() {
    const text = textarea.value.trim();
    if (!text) return;
    const name = prompt("Enter your name:");
    const timestamp = new Date().toLocaleString();
    const note = { name, text, timestamp };
    notes.set(note);
    textarea.value = '';
  }

  notes.map().on((data, id) => {
    if (!data || !data.text) return;
    if (document.getElementById(id)) return;

    const bubble = document.createElement('div');
    bubble.className = 'chat-bubble';
    bubble.id = id;
    bubble.innerHTML = `${data.text}<small>${data.name} @ ${data.timestamp}</small>`;
    notesDisplay.appendChild(bubble);
  });
</script>
</body>
</html>
